---
title: 本編導入:僕らの向き合うべきものはなにか
---

さて、偉人から学ぶことはできた一方、歴史から学び取れたことは少ない。
今一度、僕らが彼女(Perlと読む)にどう向き合うべきなのか考えてみよう。

# この章の要点
- 向き合うものを見定める

# 振り返り

前回までにわかったことを端的に書くと、
- Perlは書くのは簡単だが、学ぶのは難しい
- Perlはテキスト処理、Unixコマンドとの併用において未だに強力なツールである

という2行にまとまってしまう。

そして、少なくとも僕の眼前にあるものはまさにテキスト処理を中心に行うシステムだ。
DBからバカでっかいCSVもどきファイル(25GB,25GB,15GB...)をぶち抜いて、列の要素に着目しながらSort, Joinしたり、その成果物をある条件に基づいてフィルタしたりする。
太古の時代に置いては、いかなOracleDBといえどこの規模のデータでJoinなど書かれた日にはメモリが持たなかったのかもしれない。（今でもなかなかだと思うが）

用途が正しいとするならば、僕らは何につまずいているのだろうか。
いわんや、彼女そのものと、そのコードである。

作り始めた某は、Perlのことをよくわかっていたのかもしれない。
でも、それに続く者たち全てがPerlに詳しいわけではなかった。それでも、メンテしないといけなかった。
時間の経過とともに、どんどんと化け物に育っていったに違いない。
結果、輪をかけて読みづらいコードで、複雑怪奇な挙動をする継ぎ接ぎのシステムが数年の時を経て爆誕しているのである。

ようは、これはレガシーコードなのだ。

複雑さは2軸で存在する。
- そもそもPerlが読めないことによって感じる複雑さ
- システム、コードの設計そのものが破綻していることによって感じる複雑さ

前者がPerlの問題(正確には、Perlを読めない我々の問題)であり、後者がレガシーコードの問題である。

# 解決に向けて
さて、ようやく本題と向き合える。

では、何を解決すれば僕らはスタートラインに立てるのだろうか。
当然、Perlをどうにかしなければならない。

前章から学んだことは、一般に持ち得る、流行りの言語知識がPerlに対してほとんど無力であるということだ。
我々はすでに学んだ経験から、新しい言語で書かれものを読むことはそう難しくないことを経験的に知っている。
だが、Perlにそれは通用しない。
きちんと学ばなければならない。

レガシーコードに向き合うのはその後だ。
Perlがわからないんじゃ「レガシーコードの脱却」を読んだところで適応するのは難しい。
クソコードをクソコードでリファクタリングしても仕方ないのだ。

故に、まずはPerlの練習問題を解くことにした。
この工程はただのレベル上げであり、本にすることが色んな意味で難しいので省略する。
端的には、下記のオライリー本には章末問題がついてくるので、愚直に解いて見比べることにした。

- [初めてのPerl 第7版](https://amzn.to/3bx3Lbv)

さらに、気になる機能のリファレンスとして下記を参照した。
- [続・初めてのPerl 改訂第2版 ](https://amzn.to/3brDueL)
- [マスタリングperl](https://amzn.to/3ExTnwv)

## 問題と、解いたコード
下記のレポジトリに格納しているが、書籍の解答コードは再配布にあたるため掲載しない。
あくまで私の解答に過ぎないことに注意。

## 動作環境
- MacOS BigSur
- anyenvでいれたplenvでいれたperl5.16.0
- [perl-buildをプラグインで使う点に留意](https://qiita.com/narita_cpp/items/03e55b9acf4b3fbed99c)

# Perlと向き合うためのポイント
我々は熟練のPerlエンジニアを目指すべきだが、気をつけるべき点がある。
作るコードについて、可読性は高く保ち、読み手の学習コストを上げてはならない。
便利だから、早くかけるから、Perlの強力な糖衣構文を用いることは避けなければならない。

我々が保守しているのはシステムで、書き手よりも読み手のほうが圧倒的に多いのだ。
そして、Perlが読めるエンジニアは少なく、多くのポストでPerlが読めることは重要ではない。
つまり、難解なPerlを読みながらも、やさしいPerlへとリファクタリングしていくことが、まず第一歩となるだろう。

## 暗記するもの
Perlの仕様上、理解するために避けられないもの。

### [コンテキストを理解する](https://perlzemi.com/blog/20080608121292.html)
スカラーコンテキストとリストコンテキストがある. コンテキストをみて動作を変える処理がPerlには存在する.

```perl
# 下記2つはSTDINのとる振る舞いが異なる.
my $value = <STDIN>;
my $list = <STDIN>;
```

## 可読性のために工夫できるもの
Perlを知らない人向けにもわかりやすく書く工夫ができるもの

### [デフォルト変数_$](https://perlzemi.com/blog/20180118151628.html)の使用を避ける
前章であげた次のコードの可読性は著しく低い.
```perl:sample.pl
while(<>) {
    chomp;
    print join("\t", (split /:/)[0, 2, 1, 5] ), "\n";
}
```

しかし、このように書くことで、多少はPerl固有の前提知識を減らす事ができる。
デフォルト変数を使わないことで、変数の命名が可能になり、データに意味をもたせて説明することができる。
```perl:sample.pl
while(my $line = <>) {
    chomp($line);
    my @split = (split(/:/, $line))[0, 2, 1, 5];
    my $string = join("\t", @split);
    print $string, "\n"
}]
```
コード量は増えるものの、読めないより遥かにマシである。

